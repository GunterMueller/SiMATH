/*M
.SH NAME
manfsexp - matrix of number field elements, sparse representation, exponentiation

.SH SYNOPSIS
.nf
#include<_matr2.h>

matrix manfsexp(F, M, n)
pol F;
matrix M;
single n;

.SH DESCRIPTION
manfsexp() returns the matrix M^n.
For n<0 the determinant of M must be invertible.

.PP
.TP 4
.B F
is an irreducible monic sparse polynomial in one variable over the rational numbers.
.TP 4
.B M
must be a square matrix over the number field generated by F.
.TP 4
.B n
with -BASIS+1 <= n <= BASIS-1 is the exponent of the result.
M*/



/*H
	Version 1       06.06.1990      Th. Weis
	Version 2	27.10.1993	MANFSCONS1 hat jetzt 2 Parameter.  PS
	Version 3       27.01.1994      Georg Rock
                                        Habe  induktives Potenzieren,d.h.
                                        A^n = A*A*A*A*A... (n-mal) durch
                                        binaeres Potenzieren ersetzt.
   DATE manfsexp      : 910915.931130.941201
nH*/

#include <_matr2.h>

matrix manfsexp( F, M, n )
pol    F;
matrix M;
single n;

{
	matrix M1;
	single m;

	bind( F, M );
	init( M1 );

/* n gleich 0 */

	if ( !n )
	{
           m = manrrow( M );
	   M1 = manfscons1( F, m );
	}

/* M gleich 0 */

	else    if ( isnullma( M ) ) M1 = M;

/* n, M ungleich 0 */

	   else
	   {
	      if ( n < 0 )
	      {
	         M = manfsinv( F, M );
	         n = -n;
	      }
	      m = manrrow( M );
	      for (M1 = manfscons1( F, m ); n; n /= 2) /* Binaeres Potenzieren */
                {
                      if (n%2) M1 = manfsprod( F, M1, M );

                      if (n != 1) M = manfsprod( F, M, M );
                }

	   }

/* Ausgabe */

	return( M1 );
}


